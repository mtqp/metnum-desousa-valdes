%********************************************************************************************
%								COMANDOS ÚTILES PARA LATEX EN ESTE TP							
%
%	\ : espacio simple
%	\\ : nueva línea
%	\par : va a la línea de abajo y deja sangría
%	\vspace{##tamaño en pt##} o \vspace{\baselineskip} en general:
%								 para dejar un espacio vertical
%	\textbf{text} :text en negrita
%	\textit{text} :text en itálica
%
% GRAFICOS CENTRADOS:
%	\begin{center}
%		\includegraphics[width=\textwidth]{./img/##ruta imagen (no hace falta extension)##}
%	\end{center}
%		--> se pueden agregar atributos como scale por si se hace muy grande
%
% TABLAS CENTRADAS:
%	\begin{center}
%	\begin{tabular}{|c|c|}
%	\hline
%	\ \textbf{Programa} & \textbf{Ticks} \\
%	\hline
%		ASM & 675127609 \\
%	\hline
%	\end{tabular}
%	\end{center}
%
% ALGORITMOS (EN VARIOS LENGUAJES):
% \begin{lstlisting}
%	void sumoDiez(int &num)
%	{
%	    num += 10;
%	}
%	
%	int main()
%	{
% 	   int i;
%	    int numeroAProcesar = 20;
%	    for (i = 0; i < 50; i++)
%	    {
%	        sumoDiez(numeroAProcesar);	//Proceso el numero en cada ciclo
%	    } 
%	    return 0;
%	}
%	\end{lstlisting}
%
% para info sobre todo lo que tiene el package detallado:
% http://en.wikibooks.org/wiki/LaTeX/Source\_Code\_Listings
%
%********************************************************************************************

\documentclass[10pt,a4paper]{article}
\usepackage[utf8]{inputenc} % para poder usar tildes en archivos UTF-8
\usepackage[spanish]{babel} % para que comandos como \today den el resultado en castellano
\usepackage{a4wide} % márgenes un poco más anchos que lo usual
%\usepackage{geometry}

%\usepackage{layout}

%\geometry{
%  includeheadfoot,
%  margin=2.7cm
%}

\usepackage[conEntregas]{caratula}
\usepackage{amssymb}
\usepackage{fancybox}
\usepackage[usenames,dvipsnames]{color}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{clrscode3e}
\usepackage{xcolor}
\usepackage{amsmath}


\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=black
}

\lstdefinestyle{customc}{
  belowcaptionskip=1\baselineskip,
  breaklines=true,
  frame=L,
  xleftmargin=\parindent,
  language=C,
  showstringspaces=false,
  basicstyle=\footnotesize\ttfamily,
  keywordstyle=\bfseries\color{green!40!black},
  commentstyle=\itshape\color{purple!40!black},
  identifierstyle=\color{blue},
  stringstyle=\color{orange},
}

\lstset{escapechar=@,style=customc}

\begin{document}

\titulo{Trabajo Práctico 2}
\subtitulo{Tirate un qué, tirate un ranking... [Primera entrega]}

\fecha{\today}

\materia{Métodos Numéricos}
\grupo{Grupo Autodenominado "Los Pichis"}

\integrante{De Sousa Bispo, Germán Edgardo}{359/12}{german\_nba11@hotmail.com}
\integrante{De Sousa Bispo, Mariano Edgardo}{389/08}{marian\_sabianaa@hotmail.com}
\integrante{Valdés Castro, Tobías}{800/12}{tobias.vc@hotmail.com}


\maketitle

\tableofcontents
\newpage

\section*{Introducción}
\addcontentsline{toc}{section}{Introducción}

Los talentosos y apuestos muchachos que instauraron la moda de los cabellos raros y los pasos bailables más utilizados en los últimos años han caído lentamente en el olvido. Con el fin de volver a su momento de gloria, el grupo tropical nos ha contactado para brindarles una solución teniendo en cuenta el bajo presupuesto con el que cuentan en el momento.
\par 
Teniendo en cuenta que los motores de búsqueda son herramientas claves para explorar la red y para determinar un orden de páginas según cierta importancia para presentar la información en orden de relevancia, el equipo de Métodos Númericos ha llegado a la conclusión que, para que el grupo de genios musicales obtenga el nivel de divulgación necesario para volver a todos los televisores nacionales e internacionales, debe figurar en páginas importantes en la web.
El problema ahora radica en cuáles son las páginas importantes que posicionarán al grupo en los primeros links de cualquier búsqueda tropical. 
\par 
De esta manera, el grupo autodenominado ``Los Pichis'' comenzó la labor de estudiar algunos de los más conocidos algoritmos de búsqueda: \textit{In-Degree}, \textit{PageRank} y \textit{Hyperlink-Induced Topic Search}(HITS).
\par 
El primero se basa en generar el ranking de importancia de la web teniendo en cuenta solamente la cantidad de links que apuntan a la página. Mientras mayor sea la cantidad de links, más importante es la página. 
\par
\textit{PageRank} es un algoritmo que luego de buscar en toda la red e indexar los datos obtenidos para realizar una búsqueda eficiente, rankea la importancia de la base de datos de manera que, cuando el usuario realiza una búsqueda, las páginas más importantes se presenten primero. Si una página $u$ apunta a una página $v$, se puede decir que $v$ es importante. Sin embargo, para no dejar que simplemente una página sea más importante por tener muchas páginas apuntadas a ella, se puede realizar un ponderado de los links utilizando la importancia de la página de origen (no es lo mismo ser apuntado por una página importante que por muchas no importantes). De esta manera, consideramos la importancia de una página $v$ como la importancia de la página $u$ (que apunta a $v$) e inversamente proporcional al grado de $u$ (es decir, la cantidad de links que  posee la página $u$). Entonces, si la página $u$ contiene $n_u$ links, uno de los cuales apunta a $v$, el aporte de ese link a la página $v$ será $x_u / n_u$.
Como para cada página pedimos la siguiente ecuación: 
\begin{eqnarray}
x_k = \sum_{j \in L_k} \frac{x_j}{n_j},~~~~k = 1,\dots,n. \label{eq:basicmodel}
\end{eqnarray}
Luego, el modelo planteado es equivalente a encontrar un $x\in \mathbb{R}^n$ tal que $Px = x$. Esto significa, encontrar un autovector asociado al autovalor 1 de una matriz cuadrada, tal que $x_i \ge
0$ y $\sum_{i = 1}^n x_i = 1$.
\par 
Finalmente, la idea del método \textit{HITS} se basa en una noción de autoridad que se trasmite de una página a otra mediante links. Es decir, se considera que existen páginas que cumplen rol de autoridad sobre un tema y se trata de modelar la relación entre estas páginas y aquelllas que las apuntan, las cuales se denominan hubs. 
La relación entre ambos se establece matricialmente de la siguiente forma: 

\begin{eqnarray}
x & = & A^ty \label{eq:auth-update-math} \\
y & = & Ax, \label{eq:hub-update-math} 
\end{eqnarray}

Siendo $x$ un vector de peso de autoridad, $y$ el de los hubs y $A$ la matriz de adyacencia creada a partir de los links de una página a otra.
Kleinberg propone en \textit{Authoritative sources in a hyperlinked environment} con un $y_0$ inicial, al cual aplicarle esta ecuación iterativamente para que, bajo ciertas condiciones que nuestro problema cumple, el método converja. En base a este ranking obtenido luego de realizar las iteraciones, se obtienen las páginas que son mejores autoridades y mejores hubs.




aplicando luego el paso de normalizaci\'on correspondiente. Los autores proponen comenzar con un $y_0$ incial, aplicar estas ecuaciones 
iterativamente y demuestran que, bajo ciertas condiciones, el m\'etodo converge. Finalmente, en base a los rankings obtenimos, se retorna
al usuario las mejores $t$ \emph{autoridades} y los mejores $t$ \emph{hubs}.


\section{Desarrollo}
\subsection{Ideas sobre la Implementación}

\subsubsection{Características generales del problema}


\subsection{Implementación}

	En la implementación, decidimos utilizar herencia y polimorfismo para simplificar el código. Este trabajo práctico es significativamente más grande que el anterior; una implementación descuidada necesariamente nos conduciría a muchos errores, complejos de encontrar y corregir. 

	Los puntos centrales tenidos en cuenta para el desarrollo fueron:

	\begin{itemize}
		\item \textbf{Algoritmos}: Debemos implementar tres algoritmos distintos para buscar prácticamente la misma información: \textit{Page Rank, HITS, In Degree}
		\item \textbf{Parsing}: El parseo de los archivos de inputs deben ser distintos dependiendo de su instancia: \textit{Standford, Toronto}
		\item \textbf{Declaratividad}: Nos es más fácil pensar el problema si tenemos una \texttt{WebNet} y un conjunto de \texttt{WebPage} para aplicar los algoritmos, las cuales poseen a su vez \texttt{Rank} . En el único momento que efectivamente necesitamos sus valores (por ejemplo cantidad de nodos con los que se conecta) es para aplicar el método de la potencia. De esta manera la implementación de las operaciones de matriz quedan ocultas dentro de cada algoritmo de \textit{ranking}.
	\end{itemize}

	Escribiendo un pseudo-código, el punto de entrada \textit{(main)} de nuestra aplicación es muy similar al siguiente:

	\vspace{\baselineskip}
	\begin{codebox}
	\Procname{$\proc{PageRanking}()$}
	\li ParsingAlgorithm \id{parsingAlgorithm} = createParsingAlgorithmFromParameters(entryPointParameters)
	\li WebNet \id{net} = parsingAlgorithm.parseFile(webDefinitionFile)
	\li RankingAlgorithm \id{rankingAlgorithm} = createRankingAlgorithmFromParameters(entryPointParameters)
	\li rankingAlgorithm.RankPages(net)
	\li parsingAlgorithm.SaveRank(net)
	\End
	\end{codebox} 
	\vspace{\baselineskip}

	Como se comentó anteriormente, es necesario para \textit{Page Rank} y \textit{HITS} aplicar un método iterativo para obtener el \textit{ranking} que buscamos. En este trabajo, utilizamos el método de la potencia. 

	Por otro lado, sabemos que la red generada por la interconexión entre páginas genera un grafo donde el grado de cada nodo rara vez es \textit{n} (siendo \textit{n} la cantidad de páginas). Por lo tanto, generar la matriz de adyacencia no parece ser una buena solución: tendríamos muchos elementos cuyo valor es cero. La cátedra sugirió tres posibles implementaciones de matrices esparsas: \textit{Dictionary of keys (DOK)}, \textit{Compressed Sparse Row (CSR)} y \textit{Compressed Sparse Column (CSC)}. Nosotros optamos por \textit{CSR}, y la justificación la detallamos a continuación.

\subsubsection{Implementación con matriz Column Sparse Row (CSR)}

	Definamos como \textit{n} a la cantidad de columnas y filas de la matriz, \textit{CSR} la almacena utilizando únicamente tres arreglos (sean: \textit{rowPointers, colIndexes y values}), la dimensión de ellos son: \textit{n} para \textit{rowPointers}, cantidad de elementos no nulos para \textit{colIndexes} e igual cantidad para \textit{values}.

	La semántica de estos arreglos es la siguiente, suponiendo que \textit{i} hace referencia a filas y \textit{j} a columnas:

	\begin{itemize}
		\item \texttt{rowPointers}: El valor de la i-ésima posición referencia el índice de colIndexes a partir del cual se encuentran los elementos de la i-ésima fila. En caso de no haber elementos en la i-ésima fila de la matriz, esta posición se completa con el mismo valor que la i-1 (simplemente por cuestiones implementativas).
		\item \texttt{colIndexes}: El valor contenido dentro de cada posición representa a \textit{j}
		\item \texttt{values}: Contiene los valores de la matriz, cada posición se relaciona uno a uno con \textit{colIndexes}.
	\end{itemize}

	Si queremos obtener el elemento $a_ij$ podemos definir el siguiente pseudo-codigo:

	\vspace{\baselineskip}
	\begin{codebox}
	\Procname{$\proc{Element}(i, j)$}
	\li int \id{colIndexLower} = rowPointers[i]
	\li int \id{colIndexUpper} = rowPointers[i+1]
	\li foreach col : colIndexLower to colIndexUpper
	\li .	if  colIndexes[col] == j
	\li .	.	return values[col]
	\End
	\end{codebox} 
	\vspace{\baselineskip}

	De esta manera resulta muy sencillo efectuar una multiplicación entre la matriz y un vector: Iterando las filas multiplicamos solo las posiciones \textit{j} del vector que tengamos en colIndexes por el valor almacenado en values. Si ninguna multiplicación es efectuada, el valor el cero. Por la naturaleza de la multiplicación de matriz por vector, resulta poco útil utilizar la estructura \textit{CSC}. \textit{CSC} es conveniente si necesitamos multiplicar por la traspuesta de una matriz, ya que el mismo algoritmo la recorrería de manera traspuesta. En el algoritmo de \textit{HITS} necesitamos la traspuesta, sin embargo, utilizamos la misma estructura, cargando los índices de manera inversa.

	Tanto \textit{CSR} como \textit{CSC} son complejos de crear si los datos no son suministrados de manera ordenada. Para eso, generamos una clase \textit{CSRBuilder} al cual se le pasan los datos de manera desordenada y una vez que la carga de datos se completa, se encarga de ordenarlos, crear los índices e instanciar una \textit{CSRMatrix}. Si bien no es idéntico, preserva el espíritu de un \textit{DOK}, ya que termina utilizando de cláve \textit{i, j} por la cual ordena la información antes de generar la matriz esparsa por filas. 

	Por la modularización generada, no sería complejo modificar el programa para incluir las dos implementaciones faltantes y hacer pruebas de \textit{performance}. Lamentablemente por falta de tiempo, esto no fue posible.

\subsubsection{Problemas en la Implementación}

	En comparación al trabajo anterior, tuvimos menor cantidad de problemas a la hora de la implementación. 

	Notamos dos como relevantes: para el algoritmo de Standford supusimos que los comentarios no se incluían en los tests. Sin embargo a la hora de testearlo estos los incluían. El segundo punto a destacar fue por desconocimiento del lenguaje: nos tomó bastante tiempo entender cómo implementar un método abstracto así como dada una instancia concreta, devolver su super clase. El compilador no nos ayudó con la descripción de los errores.

\subsection{Experimentación}
\subsubsection{Convergencia de PageRank}

\subsubsection{Convergencia de HITS}

\subsubsection{Tiempo de Cómputo}	

\subsubsection{Análisis Cualitativo}

\subsubsection{Casos de Ejemplo}
	
	
\section{Conclusión}


\section{Bibliografía y referencias} %arreglar cuando se termine 

\begin{itemize}
	\item \textbf{STL de C++}: \url{http://en.cppreference.com}.
%	\par Para la función \texttt{rand()}, \url{http://en.cppreference.com/w/cpp/numeric/random/rand}.
%	\par Para la función \texttt{sort()}, \url{http://en.cppreference.com/w/cpp/algorithm/sort}.
%	\item Distribución de \texttt{rand()}?, \url{http://eternallyconfuzzled.com/arts/jsw\_art\_r and.aspx}
	\item \textbf{Funciones de Métodos Numéricos:}
		\par Eliminación Gaussiana y \textit{backward substitution}: Richard BURDEN, Numerical Analysis 9th Ed. Chapter 6
	\item \textbf{Contador de clocks}: \url{http://www.mcs.anl.gov/\~kazutomo/rdtsc.html}
\end{itemize}


\end{document}
